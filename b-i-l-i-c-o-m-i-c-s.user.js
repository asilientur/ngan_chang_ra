// ==UserScript==
// @name         b-i-l-i-c-o-m-i-c-s
// @namespace    https://github.com/asilientur/ngan_chang_ra/raw/main/b-i-l-i-c-o-m-i-c-s.user.js
// @version      2023.11.08.1
// @description  down b-i-l-i-c-o-m-i-c-s
// @author       You
// @match        https://www.bilibilicomics.com/mc*/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=www.bilibilicomics.com
// @require      https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js
// @grant        none
// @downloadURL  https://github.com/asilientur/ngan_chang_ra/raw/main/b-i-l-i-c-o-m-i-c-s.user.js
// @updateURL    https://github.com/asilientur/ngan_chang_ra/raw/main/b-i-l-i-c-o-m-i-c-s.meta.js
// ==/UserScript==

(function(_0x369666,_0x5043c2){const _0x241b02=a0_0x4930,_0x1e8ad4=_0x369666();while(!![]){try{const _0x325ca9=-parseInt(_0x241b02(0xee))/0x1*(parseInt(_0x241b02(0xe6))/0x2)+-parseInt(_0x241b02(0xd2))/0x3+-parseInt(_0x241b02(0x106))/0x4*(-parseInt(_0x241b02(0xd8))/0x5)+-parseInt(_0x241b02(0xb2))/0x6+parseInt(_0x241b02(0xce))/0x7+-parseInt(_0x241b02(0xf7))/0x8+parseInt(_0x241b02(0xd4))/0x9*(parseInt(_0x241b02(0x102))/0xa);if(_0x325ca9===_0x5043c2)break;else _0x1e8ad4['push'](_0x1e8ad4['shift']());}catch(_0x3ddc8c){_0x1e8ad4['push'](_0x1e8ad4['shift']());}}}(a0_0x133a,0x52dbf));let downloading_current=0x0,downloading_total=0x0;function sleep(_0x1b097e){return new Promise(_0x302f09=>setTimeout(_0x302f09,_0x1b097e));}const download_not_encrypted=async(_0x20caad,_0x1b76e8)=>{const _0x41e9f8=a0_0x4930,_0x3d766a=await fetch(_0x20caad[_0x41e9f8(0xbb)]),_0x1e79b9=await _0x3d766a[_0x41e9f8(0xe3)](),_0x44b934=new DataView(_0x1e79b9),_0xc5ecee=_0x44b934['getUint32'](0x0,![])['toString'](0x10);if(_0xc5ecee==='52494646'){const _0x5604ac=new Blob([_0x1e79b9],{'type':_0x41e9f8(0xf0)});saveAs(_0x5604ac,_0x20caad[_0x41e9f8(0x107)]+_0x41e9f8(0xf8)),downloading_current+=0x1,update_status();}else{if(_0xc5ecee===_0x41e9f8(0xd7)){const _0x1d578a=new Blob([_0x1e79b9],{'type':_0x41e9f8(0xba)});saveAs(_0x1d578a,_0x20caad[_0x41e9f8(0x107)]+'.png'),downloading_current+=0x1,update_status();}else{const _0x591cfc=new Blob([_0x1e79b9],{'type':'image/jpeg'});saveAs(_0x591cfc,_0x20caad[_0x41e9f8(0x107)]+_0x41e9f8(0x104)),downloading_current+=0x1,update_status();}}};function update_status(){const _0x28a003=a0_0x4930;document['querySelector'](_0x28a003(0xda))['style'][_0x28a003(0xeb)]='block',document['querySelector'](_0x28a003(0xda))['innerHTML']=downloading_current+_0x28a003(0xf4)+downloading_total;}function a0_0x4930(_0xb942e0,_0x2e900d){const _0x133a4b=a0_0x133a();return a0_0x4930=function(_0x49305e,_0x5e172d){_0x49305e=_0x49305e-0xb0;let _0x2b9ae3=_0x133a4b[_0x49305e];return _0x2b9ae3;},a0_0x4930(_0xb942e0,_0x2e900d);}function create_status_box(){const _0x2fe8ac=a0_0x4930;let _0x20d4d3=document[_0x2fe8ac(0xb0)](_0x2fe8ac(0xf5));return _0x20d4d3[_0x2fe8ac(0xfa)]=_0x2fe8ac(0xdc),_0x20d4d3[_0x2fe8ac(0xbd)]=downloading_current+_0x2fe8ac(0xf4)+downloading_total,_0x20d4d3;}function create_download_icon(){const _0x36e678=a0_0x4930;let _0x49cccc=document[_0x36e678(0xb0)]('div'),_0x263762=document[_0x36e678(0xb0)]('img');_0x263762['className']='tai-ve',_0x263762[_0x36e678(0xcd)](_0x36e678(0xdd),_0x36e678(0xc8)),_0x263762['style'][_0x36e678(0xef)]=_0x36e678(0xb6),_0x263762[_0x36e678(0xfb)]['cursor']=_0x36e678(0xc0),_0x49cccc[_0x36e678(0xc5)](_0x263762);let _0x54d1fc=document[_0x36e678(0xb0)](_0x36e678(0x108));_0x54d1fc['rel']=_0x36e678(0xf9),_0x54d1fc[_0x36e678(0x10a)]=_0x36e678(0xd3),document[_0x36e678(0xc9)](_0x36e678(0xc1))[0x0][_0x36e678(0xc5)](_0x54d1fc);let _0x32a61f=document[_0x36e678(0xb0)]('div');_0x32a61f['className']='status',_0x32a61f[_0x36e678(0xfb)]['display']=_0x36e678(0xd6),_0x32a61f[_0x36e678(0xfb)][_0x36e678(0xe5)]=_0x36e678(0xe4),_0x32a61f[_0x36e678(0xfb)][_0x36e678(0xfc)]=_0x36e678(0xe4),_0x32a61f[_0x36e678(0xfb)][_0x36e678(0xbc)]=_0x36e678(0xdb),_0x32a61f['style'][_0x36e678(0x100)]=_0x36e678(0xc4),_0x32a61f[_0x36e678(0xfb)][_0x36e678(0xff)]=_0x36e678(0xb8),_0x32a61f[_0x36e678(0xfb)][_0x36e678(0xd0)]='0.5rem',_0x32a61f[_0x36e678(0xfb)]['left']=_0x36e678(0xb7),_0x32a61f[_0x36e678(0xfb)][_0x36e678(0xf6)]=_0x36e678(0xb1);let _0x2766e4=create_status_box();const _0x339308=document[_0x36e678(0xb0)]('style');_0x339308[_0x36e678(0xbd)]=_0x36e678(0xfe),document['head'][_0x36e678(0xc5)](_0x339308),_0x32a61f[_0x36e678(0xc5)](_0x49cccc),_0x32a61f[_0x36e678(0xc5)](_0x2766e4);let _0x5b1ea0=document['querySelector']('body'),_0x300494=_0x5b1ea0[_0x36e678(0xe8)];return _0x5b1ea0[_0x36e678(0xe7)](_0x32a61f,_0x300494),_0x32a61f;}const throttlePromises=async(_0xfbd4d0,_0x1240cc)=>{const _0x4ba322=a0_0x4930;while(_0xfbd4d0['length']>0x0){await Promise[_0x4ba322(0xf1)](_0xfbd4d0[_0x4ba322(0x101)](0x0,_0x1240cc)['map'](_0x3b0035=>_0x3b0035())),await sleep(0xc8);}},on_heartbeat_css=()=>{const _0x2233f7=a0_0x4930;let _0x5332ba=document[_0x2233f7(0x109)]('#heartbeat');!_0x5332ba&&(_0x5332ba=document[_0x2233f7(0xb0)](_0x2233f7(0xfb)),_0x5332ba[_0x2233f7(0xcd)]('id','heartbeat'),document[_0x2233f7(0xc1)]['appendChild'](_0x5332ba)),_0x5332ba['textContent']=_0x2233f7(0xde);},off_heartbeat_css=()=>{const _0x347794=a0_0x4930,_0x59def9=document['querySelector'](_0x347794(0x103));_0x59def9[_0x347794(0xbd)]='';};((async()=>{const _0x2ffe8b=a0_0x4930,_0x41597d=create_download_icon();_0x41597d['addEventListener'](_0x2ffe8b(0xc3),async()=>{const _0x3a4a6a=_0x2ffe8b;on_heartbeat_css();const _0x3af2e1=_0x3a4a6a(0xc7),_0x569d5c='/GetEpisode?device=pc&platform=web&lang=en&sys_lang=en',_0x1d4e2b=_0x3a4a6a(0xea),_0x3b102e=_0x3a4a6a(0xbf),_0x444b35=_0x3a4a6a(0xb9),_0x10250f=document[_0x3a4a6a(0xcf)][_0x3a4a6a(0x10a)],_0x513594=_0x10250f[_0x3a4a6a(0xcb)](/\/mc\d+\/(\d+)/),_0x2eb6de=Number[_0x3a4a6a(0xe9)](_0x513594[0x1],0xa),_0x3ed301=Object[_0x3a4a6a(0xb4)](document[_0x3a4a6a(0xc6)][_0x3a4a6a(0xdf)](';\x20')[_0x3a4a6a(0xec)](_0x1f1d03=>_0x1f1d03[_0x3a4a6a(0xdf)](/=(.*)/s)[_0x3a4a6a(0xec)](decodeURIComponent))),{accessToken:_0x4247aa}=JSON['parse'](_0x3ed301[_0x3a4a6a(0xb5)]),_0xc7d210={'Authorization':_0x3a4a6a(0xe2)+_0x4247aa,'content-type':'application/json;charset=UTF-8'},_0x2bccca=await fetch(''+_0x3af2e1+_0x569d5c,{'method':_0x3a4a6a(0x105),'body':JSON[_0x3a4a6a(0xc2)]({'id':_0x2eb6de}),'headers':{'Authorization':_0x3a4a6a(0xe2)+_0x4247aa,'content-type':_0x3a4a6a(0xbe)}}),_0x266ef2=await _0x2bccca['json'](),{comic_id:_0x381992,comic_title:_0x1d79be,short_title:_0xf3e728,title:_0x73a80e}=_0x266ef2[_0x3a4a6a(0xf2)];let _0x11b0e3='';const _0x18c558=await fetch(_0x444b35,{'method':'POST','body':JSON['stringify']({'comic_id':_0x381992,'ep_id':_0x2eb6de,'type':0x1}),'headers':_0xc7d210}),_0x5eb5b4=await _0x18c558['json']();_0x5eb5b4?.[_0x3a4a6a(0xf2)]?.[_0x3a4a6a(0xca)]&&(_0x11b0e3=_0x5eb5b4[_0x3a4a6a(0xf2)][_0x3a4a6a(0xca)]);const _0x14bf08={'ep_id':_0x2eb6de};_0x11b0e3&&(_0x14bf08[_0x3a4a6a(0xca)]=_0x11b0e3);const _0x51ba96=await fetch(''+_0x3af2e1+_0x1d4e2b,{'method':_0x3a4a6a(0x105),'body':JSON['stringify'](_0x14bf08),'headers':_0xc7d210}),_0x1a87ae=await _0x51ba96[_0x3a4a6a(0xb3)](),_0x14b76e=_0x1a87ae[_0x3a4a6a(0xf2)][_0x3a4a6a(0xd9)][_0x3a4a6a(0xec)](_0x559563=>_0x559563['path']),_0x41a146=_0x14b76e[_0x3a4a6a(0xec)](_0x505cd6=>'\x5c\x22'+_0x505cd6+'\x5c\x22'),_0x51db14=await fetch(''+_0x3af2e1+_0x3b102e,{'method':_0x3a4a6a(0x105),'headers':_0xc7d210,'body':_0x3a4a6a(0xd1)+_0x41a146[_0x3a4a6a(0xcc)](',')+_0x3a4a6a(0xe0)}),_0x440509=await _0x51db14[_0x3a4a6a(0xb3)](),_0x385d9c=[];for(const [_0x2e7e2f,_0x554774]of _0x440509[_0x3a4a6a(0xf2)][_0x3a4a6a(0xd5)]()){const {url:_0x1de0f6,token:_0x5e264a}=_0x554774;_0x385d9c[_0x3a4a6a(0xfd)]({'name':(''+(_0x2e7e2f+0x1))[_0x3a4a6a(0xf3)](0x3,'0'),'source_url':_0x1de0f6+_0x3a4a6a(0xed)+_0x5e264a});}if(_0x385d9c[_0x3a4a6a(0xe1)]>0x0){downloading_total=_0x385d9c['length'],downloading_current=0x0;const _0xa2bbe1=_0x385d9c[_0x3a4a6a(0xec)]((_0xa5f6ae,_0x56f4e5)=>()=>download_not_encrypted(_0xa5f6ae,_0x56f4e5));await throttlePromises(_0xa2bbe1,0x4);}});})());function a0_0x133a(){const _0x1d5ae4=['{\x22urls\x22:\x22[','955977nQqsWs','https://fonts.googleapis.com/css2?family=Acme&display=swap','27QlYFkR','entries','flex','89504e47','5CRdhhY','images','.status-num','1.5rem','status-num','src','\x0a\x20\x20\x20\x20\x20\x20.tai-ve\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20heartbeat\x202s\x20infinite;\x20/*\x20Apply\x20the\x20heartbeat\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform-origin:\x20center;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20@keyframes\x20heartbeat\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Start\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2025%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2025%\x20of\x20the\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2050%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.2);\x20/*\x20Scale\x20up\x20at\x2050%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Return\x20to\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2075%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2075%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20End\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20','split',']\x22}','length','Bearer\x20','arrayBuffer','center','justifyContent','62zaeOBG','insertBefore','firstChild','parseInt','/GetImageIndex?device=pc&platform=web&lang=en&sys_lang=en','display','map','?token=','216pJfoqI','width','image/webp','all','data','padStart','\x20/\x20','div','transform','2752416jOfayO','.webp','stylesheet','className','style','alignItems','push','\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-num\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x203rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#FD7377;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-webkit-text-stroke:\x201px\x20#C62428;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x200.2rem\x20solid\x20#167975;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x201rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x202rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20#F9FDFD;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20','zIndex','position','splice','3023400NVItex','#heartbeat','.jpg','POST','5716gyeiTS','name','link','querySelector','href','createElement','translate(-50%)','2334522ndahkU','json','fromEntries','access_token','3rem','50vw','10000','https://us-user.bilibilicomics.com/twirp/global.v1.User/GetCredential?device=pc&platform=web&lang=en&sys_lang=en','image/png','source_url','gap','textContent','application/json;charset=UTF-8','/ImageToken?device=pc&platform=web','pointer','head','stringify','click','absolute','appendChild','cookie','https://www.bilibilicomics.com/twirp/comic.v1.Comic','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','getElementsByTagName','credential','match','join','setAttribute','3426052uVgAPK','location','top'];a0_0x133a=function(){return _0x1d5ae4;};return a0_0x133a();}