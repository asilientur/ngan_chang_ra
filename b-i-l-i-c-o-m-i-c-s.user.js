// ==UserScript==
// @name         b-i-l-i-c-o-m-i-c-s
// @namespace    https://github.com/asilientur/ngan_chang_ra/raw/main/b-i-l-i-c-o-m-i-c-s.user.js
// @version      2023.11.08
// @description  down b-i-l-i-c-o-m-i-c-s
// @author       You
// @match        https://www.bilibilicomics.com/mc*/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=www.bilibilicomics.com
// @require      https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js
// @grant        none
// @downloadURL  https://github.com/asilientur/ngan_chang_ra/raw/main/b-i-l-i-c-o-m-i-c-s.user.js
// @updateURL    https://github.com/asilientur/ngan_chang_ra/raw/main/b-i-l-i-c-o-m-i-c-s.meta.js
// ==/UserScript==

(function(_0x50a9b4,_0x2061d8){const _0x2a6b41=a0_0x95d2,_0x1b58fc=_0x50a9b4();while(!![]){try{const _0x5b46fe=parseInt(_0x2a6b41(0x1c1))/0x1+-parseInt(_0x2a6b41(0x1ba))/0x2+parseInt(_0x2a6b41(0x1d1))/0x3*(-parseInt(_0x2a6b41(0x1e3))/0x4)+-parseInt(_0x2a6b41(0x201))/0x5+-parseInt(_0x2a6b41(0x20a))/0x6*(-parseInt(_0x2a6b41(0x1bc))/0x7)+parseInt(_0x2a6b41(0x1c3))/0x8*(-parseInt(_0x2a6b41(0x204))/0x9)+-parseInt(_0x2a6b41(0x1cf))/0xa*(-parseInt(_0x2a6b41(0x208))/0xb);if(_0x5b46fe===_0x2061d8)break;else _0x1b58fc['push'](_0x1b58fc['shift']());}catch(_0x257932){_0x1b58fc['push'](_0x1b58fc['shift']());}}}(a0_0x553a,0x317ea));let downloading_current=0x0,downloading_total=0x0;function a0_0x95d2(_0x4c8328,_0x29f8c4){const _0x553aa1=a0_0x553a();return a0_0x95d2=function(_0x95d2b8,_0x2c9a04){_0x95d2b8=_0x95d2b8-0x1af;let _0x66bdbc=_0x553aa1[_0x95d2b8];return _0x66bdbc;},a0_0x95d2(_0x4c8328,_0x29f8c4);}function sleep(_0x5a3398){return new Promise(_0x36043d=>setTimeout(_0x36043d,_0x5a3398));}function a0_0x553a(){const _0x5ddacf=['access_token','div','POST','path','status','flex','getUint32','body','style','block','/GetEpisode?device=pc&platform=web&lang=en&sys_lang=en','createElement',']\x22}','center','stringify','location','{\x22urls\x22:\x22[','pointer','Bearer\x20','images','name','1897440JsgRto','match','parseInt','15723yEFQVR','status-num','rel','json','1850926MxCCKF','parse','1092654QfKHZY','absolute','\x0a\x20\x20\x20\x20\x20\x20.tai-ve\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20heartbeat\x202s\x20infinite;\x20/*\x20Apply\x20the\x20heartbeat\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform-origin:\x20center;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20@keyframes\x20heartbeat\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Start\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2025%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2025%\x20of\x20the\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2050%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.2);\x20/*\x20Scale\x20up\x20at\x2050%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Return\x20to\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2075%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2075%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20End\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20','click','addEventListener','0.5rem','\x20/\x20','52494646','.status-num','tai-ve','data','className','source_url','image/jpeg','77542JKUsDX','fromEntries','7TbpbnE','.webp','join','getElementsByTagName','https://www.bilibilicomics.com/twirp/comic.v1.Comic','359230aEMIiO','link','1816KzsPOZ','head','/ImageToken?device=pc&platform=web','entries','map','display','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','insertBefore','querySelector','push','img','toString','50kQFaBZ','?token=','4701RCLMQw','3rem','src','credential','top','appendChild','firstChild','textContent','splice','\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-num\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x203rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#FD7377;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-webkit-text-stroke:\x201px\x20#C62428;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x200.2rem\x20solid\x20#167975;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x201rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x202rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20#F9FDFD;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20','innerHTML','/GetImageIndex?device=pc&platform=web&lang=en&sys_lang=en','split','setAttribute','50vw','stylesheet','application/json;charset=UTF-8','all','932YMgBVa','length','#heartbeat','href','alignItems','justifyContent','https://fonts.googleapis.com/css2?family=Acme&display=swap','10000','https://us-user.bilibilicomics.com/twirp/global.v1.User/GetCredential?device=pc&platform=web&lang=en&sys_lang=en'];a0_0x553a=function(){return _0x5ddacf;};return a0_0x553a();}const download_not_encrypted=async(_0x20676e,_0x411610)=>{const _0x526245=a0_0x95d2,_0x414d03=await fetch(_0x20676e[_0x526245(0x1b8)]),_0x100264=await _0x414d03['arrayBuffer'](),_0x19f736=new DataView(_0x100264),_0x203954=_0x19f736[_0x526245(0x1f2)](0x0,![])[_0x526245(0x1ce)](0x10);if(_0x203954===_0x526245(0x1b3)){const _0x4be89a=new Blob([_0x100264],{'type':'image/webp'});saveAs(_0x4be89a,_0x20676e[_0x526245(0x200)]+_0x526245(0x1bd)),downloading_current+=0x1,update_status();}else{const _0x26e563=new Blob([_0x100264],{'type':_0x526245(0x1b9)});saveAs(_0x26e563,_0x20676e['name']+'.jpg'),downloading_current+=0x1,update_status();}};function update_status(){const _0x1955a4=a0_0x95d2;document[_0x1955a4(0x1cb)](_0x1955a4(0x1b4))[_0x1955a4(0x1f4)][_0x1955a4(0x1c8)]=_0x1955a4(0x1f5),document[_0x1955a4(0x1cb)]('.status-num')[_0x1955a4(0x1db)]=downloading_current+_0x1955a4(0x1b2)+downloading_total;}function create_status_box(){const _0x5f4aa3=a0_0x95d2;let _0x2b18f0=document['createElement'](_0x5f4aa3(0x1ed));return _0x2b18f0[_0x5f4aa3(0x1b7)]=_0x5f4aa3(0x205),_0x2b18f0[_0x5f4aa3(0x1d8)]=downloading_current+_0x5f4aa3(0x1b2)+downloading_total,_0x2b18f0;}function create_download_icon(){const _0xa56120=a0_0x95d2;let _0x1ba359=document['createElement'](_0xa56120(0x1ed)),_0x233fe0=document[_0xa56120(0x1f7)](_0xa56120(0x1cd));_0x233fe0[_0xa56120(0x1b7)]=_0xa56120(0x1b5),_0x233fe0[_0xa56120(0x1de)](_0xa56120(0x1d3),_0xa56120(0x1c9)),_0x233fe0['style']['width']=_0xa56120(0x1d2),_0x233fe0[_0xa56120(0x1f4)]['cursor']=_0xa56120(0x1fd),_0x1ba359[_0xa56120(0x1d6)](_0x233fe0);let _0x395771=document[_0xa56120(0x1f7)](_0xa56120(0x1c2));_0x395771[_0xa56120(0x206)]=_0xa56120(0x1e0),_0x395771[_0xa56120(0x1e6)]=_0xa56120(0x1e9),document[_0xa56120(0x1bf)](_0xa56120(0x1c4))[0x0][_0xa56120(0x1d6)](_0x395771);let _0x2e7cf8=document[_0xa56120(0x1f7)](_0xa56120(0x1ed));_0x2e7cf8['className']=_0xa56120(0x1f0),_0x2e7cf8[_0xa56120(0x1f4)][_0xa56120(0x1c8)]=_0xa56120(0x1f1),_0x2e7cf8[_0xa56120(0x1f4)][_0xa56120(0x1e8)]='center',_0x2e7cf8[_0xa56120(0x1f4)][_0xa56120(0x1e7)]=_0xa56120(0x1f9),_0x2e7cf8[_0xa56120(0x1f4)]['gap']='1.5rem',_0x2e7cf8['style']['position']=_0xa56120(0x20b),_0x2e7cf8[_0xa56120(0x1f4)]['zIndex']=_0xa56120(0x1ea),_0x2e7cf8['style'][_0xa56120(0x1d5)]=_0xa56120(0x1b1),_0x2e7cf8[_0xa56120(0x1f4)]['left']=_0xa56120(0x1df),_0x2e7cf8['style']['transform']='translate(-50%)';let _0x5c3a8c=create_status_box();const _0x2e4cdd=document['createElement'](_0xa56120(0x1f4));_0x2e4cdd[_0xa56120(0x1d8)]=_0xa56120(0x1da),document[_0xa56120(0x1c4)][_0xa56120(0x1d6)](_0x2e4cdd),_0x2e7cf8[_0xa56120(0x1d6)](_0x1ba359),_0x2e7cf8['appendChild'](_0x5c3a8c);let _0x41ab3d=document['querySelector'](_0xa56120(0x1f3)),_0x34d252=_0x41ab3d[_0xa56120(0x1d7)];return _0x41ab3d[_0xa56120(0x1ca)](_0x2e7cf8,_0x34d252),_0x2e7cf8;}const throttlePromises=async(_0x46d865,_0x1534f4)=>{const _0x281845=a0_0x95d2;while(_0x46d865[_0x281845(0x1e4)]>0x0){await Promise[_0x281845(0x1e2)](_0x46d865[_0x281845(0x1d9)](0x0,_0x1534f4)['map'](_0x390523=>_0x390523())),await sleep(0xc8);}},on_heartbeat_css=()=>{const _0x5b285b=a0_0x95d2;let _0x49f1ad=document['querySelector']('#heartbeat');!_0x49f1ad&&(_0x49f1ad=document['createElement'](_0x5b285b(0x1f4)),_0x49f1ad['setAttribute']('id','heartbeat'),document['head'][_0x5b285b(0x1d6)](_0x49f1ad)),_0x49f1ad['textContent']=_0x5b285b(0x20c);},off_heartbeat_css=()=>{const _0x50260d=a0_0x95d2,_0xcf449b=document[_0x50260d(0x1cb)](_0x50260d(0x1e5));_0xcf449b[_0x50260d(0x1d8)]='';};((async()=>{const _0x50ba4f=a0_0x95d2,_0xe906d=create_download_icon();_0xe906d[_0x50ba4f(0x1b0)](_0x50ba4f(0x1af),async()=>{const _0x23febe=_0x50ba4f;on_heartbeat_css();const _0x561fb3=_0x23febe(0x1c0),_0x2c0b19=_0x23febe(0x1f6),_0x259987=_0x23febe(0x1dc),_0x2b4851=_0x23febe(0x1c5),_0x22f3e1=_0x23febe(0x1eb),_0x1b42e5=document[_0x23febe(0x1fb)][_0x23febe(0x1e6)],_0x3a1df4=_0x1b42e5[_0x23febe(0x202)](/\/mc\d+\/(\d+)/),_0x50228d=Number[_0x23febe(0x203)](_0x3a1df4[0x1],0xa),_0x264ec1=Object[_0x23febe(0x1bb)](document['cookie']['split'](';\x20')[_0x23febe(0x1c7)](_0xa8c7b=>_0xa8c7b[_0x23febe(0x1dd)](/=(.*)/s)[_0x23febe(0x1c7)](decodeURIComponent))),{accessToken:_0x3d8a8d}=JSON[_0x23febe(0x209)](_0x264ec1[_0x23febe(0x1ec)]),_0x5d895b={'Authorization':_0x23febe(0x1fe)+_0x3d8a8d,'content-type':_0x23febe(0x1e1)},_0x53388c=await fetch(''+_0x561fb3+_0x2c0b19,{'method':_0x23febe(0x1ee),'body':JSON[_0x23febe(0x1fa)]({'id':_0x50228d}),'headers':{'Authorization':_0x23febe(0x1fe)+_0x3d8a8d,'content-type':_0x23febe(0x1e1)}}),_0x4b4825=await _0x53388c[_0x23febe(0x207)](),{comic_id:_0xa7971d,comic_title:_0x547ebe,short_title:_0x114a31,title:_0x2590eb}=_0x4b4825[_0x23febe(0x1b6)];let _0x52a9fc='';const _0x514c80=await fetch(_0x22f3e1,{'method':_0x23febe(0x1ee),'body':JSON['stringify']({'comic_id':_0xa7971d,'ep_id':_0x50228d,'type':0x1}),'headers':_0x5d895b}),_0x135233=await _0x514c80[_0x23febe(0x207)]();_0x135233?.['data']?.[_0x23febe(0x1d4)]&&(_0x52a9fc=_0x135233[_0x23febe(0x1b6)][_0x23febe(0x1d4)]);const _0x50e6ba={'ep_id':_0x50228d};_0x52a9fc&&(_0x50e6ba[_0x23febe(0x1d4)]=_0x52a9fc);const _0xe5d56=await fetch(''+_0x561fb3+_0x259987,{'method':'POST','body':JSON[_0x23febe(0x1fa)](_0x50e6ba),'headers':_0x5d895b}),_0x32e958=await _0xe5d56[_0x23febe(0x207)](),_0x49788f=_0x32e958[_0x23febe(0x1b6)][_0x23febe(0x1ff)]['map'](_0x3226d2=>_0x3226d2[_0x23febe(0x1ef)]),_0x8e8143=_0x49788f[_0x23febe(0x1c7)](_0x252c10=>'\x5c\x22'+_0x252c10+'\x5c\x22'),_0x1f66bc=await fetch(''+_0x561fb3+_0x2b4851,{'method':'POST','headers':_0x5d895b,'body':_0x23febe(0x1fc)+_0x8e8143[_0x23febe(0x1be)](',')+_0x23febe(0x1f8)}),_0x1f89aa=await _0x1f66bc['json'](),_0x17b3cc=[];for(const [_0x111cfd,_0x2fdcc0]of _0x1f89aa[_0x23febe(0x1b6)][_0x23febe(0x1c6)]()){const {url:_0x25d26c,token:_0x54e850}=_0x2fdcc0;_0x17b3cc[_0x23febe(0x1cc)]({'name':(''+(_0x111cfd+0x1))['padStart'](0x3,'0'),'source_url':_0x25d26c+_0x23febe(0x1d0)+_0x54e850});}if(_0x17b3cc[_0x23febe(0x1e4)]>0x0){downloading_total=_0x17b3cc[_0x23febe(0x1e4)],downloading_current=0x0;const _0xa357e7=_0x17b3cc['map']((_0x3cd7c2,_0xb7f887)=>()=>download_not_encrypted(_0x3cd7c2,_0xb7f887));await throttlePromises(_0xa357e7,0x4);}});})());