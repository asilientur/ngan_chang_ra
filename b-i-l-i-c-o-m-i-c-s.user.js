// ==UserScript==
// @name         b-i-l-i-c-o-m-i-c-s
// @namespace    https://github.com/asilientur/ngan_chang_ra/raw/main/b-i-l-i-c-o-m-i-c-s.user.js
// @version      2023.11.07
// @description  down b-i-l-i-c-o-m-i-c-s
// @author       You
// @match        https://www.bilibilicomics.com/mc*/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=www.bilibilicomics.com
// @require      https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js
// @grant        none
// @downloadURL  https://github.com/asilientur/ngan_chang_ra/raw/main/b-i-l-i-c-o-m-i-c-s.user.js
// @updateURL    https://github.com/asilientur/ngan_chang_ra/raw/main/b-i-l-i-c-o-m-i-c-s.meta.js
// ==/UserScript==

(function(_0x54d93b,_0x577648){const _0x255258=a0_0x3ed4,_0x53063a=_0x54d93b();while(!![]){try{const _0x5d23f9=-parseInt(_0x255258(0x122))/0x1*(-parseInt(_0x255258(0x14f))/0x2)+-parseInt(_0x255258(0x11a))/0x3+-parseInt(_0x255258(0x139))/0x4*(parseInt(_0x255258(0x11d))/0x5)+parseInt(_0x255258(0x12c))/0x6*(-parseInt(_0x255258(0x123))/0x7)+-parseInt(_0x255258(0x156))/0x8+parseInt(_0x255258(0x150))/0x9*(parseInt(_0x255258(0x11c))/0xa)+parseInt(_0x255258(0x10d))/0xb;if(_0x5d23f9===_0x577648)break;else _0x53063a['push'](_0x53063a['shift']());}catch(_0x46f79a){_0x53063a['push'](_0x53063a['shift']());}}}(a0_0x9b88,0x24498));let downloading_current=0x0,downloading_total=0x0;function sleep(_0x17afbe){return new Promise(_0x29d166=>setTimeout(_0x29d166,_0x17afbe));}function a0_0x3ed4(_0x432e7b,_0x49e1a2){const _0x9b887a=a0_0x9b88();return a0_0x3ed4=function(_0x3ed494,_0x182c5d){_0x3ed494=_0x3ed494-0x104;let _0x1287d5=_0x9b887a[_0x3ed494];return _0x1287d5;},a0_0x3ed4(_0x432e7b,_0x49e1a2);}const download_not_encrypted=async(_0xce2226,_0x37952e)=>{const _0x26ad4e=a0_0x3ed4,_0x5d89f8=await fetch(_0xce2226[_0x26ad4e(0x10e)]),_0x29ecf5=await _0x5d89f8[_0x26ad4e(0x107)]();saveAs(_0x29ecf5,_0xce2226['name']+'.jpg'),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();};function a0_0x9b88(){const _0x14d1e3=['length','insertBefore','top','all','addEventListener','block','124lPJuZi','heartbeat','display','3rem','json','\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-num\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x203rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#FD7377;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-webkit-text-stroke:\x201px\x20#C62428;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x200.2rem\x20solid\x20#167975;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x201rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x202rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20#F9FDFD;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20','click','div','0.5rem','pointer','match','https://www.bilibilicomics.com/twirp/comic.v1.Comic','createElement','credential','parseInt','POST','push','status-num','rel','center','stringify','cookie','2GhmQKJ','69282xPjLcE','left','stylesheet','link','split','10000','597576tQVXvZ','appendChild','{\x22urls\x22:\x22[','querySelector','blob','width','href','map','tai-ve','gap','5413870GGoXTM','source_url','parse','justifyContent','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','setAttribute','padStart','/ImageToken?device=pc&platform=web','access_token','.status-num','textContent','\x0a\x20\x20\x20\x20\x20\x20.tai-ve\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20heartbeat\x202s\x20infinite;\x20/*\x20Apply\x20the\x20heartbeat\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform-origin:\x20center;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20@keyframes\x20heartbeat\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Start\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2025%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2025%\x20of\x20the\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2050%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.2);\x20/*\x20Scale\x20up\x20at\x2050%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Return\x20to\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2075%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2075%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20End\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20','#heartbeat','495528XBxhKX','innerHTML','160tEmmja','37945kKZutG','1.5rem','head','zIndex','https://fonts.googleapis.com/css2?family=Acme&display=swap','56289kjDdWW','7VJsguf','images','50vw','\x20/\x20',']\x22}','translate(-50%)','firstChild','application/json;charset=UTF-8','className','287178PYuhIQ','?token=','status','data','style','position','path'];a0_0x9b88=function(){return _0x14d1e3;};return a0_0x9b88();}function update_status(){const _0xdeef8d=a0_0x3ed4;document[_0xdeef8d(0x106)](_0xdeef8d(0x116))[_0xdeef8d(0x130)][_0xdeef8d(0x13b)]=_0xdeef8d(0x138),document[_0xdeef8d(0x106)](_0xdeef8d(0x116))[_0xdeef8d(0x11b)]=downloading_current+_0xdeef8d(0x126)+downloading_total;}function create_status_box(){const _0x2af6c0=a0_0x3ed4;let _0x586cbf=document[_0x2af6c0(0x145)](_0x2af6c0(0x140));return _0x586cbf['className']=_0x2af6c0(0x14a),_0x586cbf[_0x2af6c0(0x117)]=downloading_current+_0x2af6c0(0x126)+downloading_total,_0x586cbf;}function create_download_icon(){const _0x2d2387=a0_0x3ed4;let _0x461557=document[_0x2d2387(0x145)]('div'),_0x46bce6=document['createElement']('img');_0x46bce6[_0x2d2387(0x12b)]=_0x2d2387(0x10b),_0x46bce6[_0x2d2387(0x112)]('src',_0x2d2387(0x111)),_0x46bce6[_0x2d2387(0x130)][_0x2d2387(0x108)]=_0x2d2387(0x13c),_0x46bce6[_0x2d2387(0x130)]['cursor']=_0x2d2387(0x142),_0x461557['appendChild'](_0x46bce6);let _0x574eee=document[_0x2d2387(0x145)](_0x2d2387(0x153));_0x574eee[_0x2d2387(0x14b)]=_0x2d2387(0x152),_0x574eee[_0x2d2387(0x109)]=_0x2d2387(0x121),document['getElementsByTagName'](_0x2d2387(0x11f))[0x0][_0x2d2387(0x104)](_0x574eee);let _0x31e323=document['createElement'](_0x2d2387(0x140));_0x31e323[_0x2d2387(0x12b)]=_0x2d2387(0x12e),_0x31e323[_0x2d2387(0x130)][_0x2d2387(0x13b)]='flex',_0x31e323[_0x2d2387(0x130)][_0x2d2387(0x110)]=_0x2d2387(0x14c),_0x31e323['style']['alignItems']='center',_0x31e323[_0x2d2387(0x130)][_0x2d2387(0x10c)]=_0x2d2387(0x11e),_0x31e323[_0x2d2387(0x130)][_0x2d2387(0x131)]='absolute',_0x31e323[_0x2d2387(0x130)][_0x2d2387(0x120)]=_0x2d2387(0x155),_0x31e323[_0x2d2387(0x130)][_0x2d2387(0x135)]=_0x2d2387(0x141),_0x31e323[_0x2d2387(0x130)][_0x2d2387(0x151)]=_0x2d2387(0x125),_0x31e323['style']['transform']=_0x2d2387(0x128);let _0x148044=create_status_box();const _0x50fe55=document[_0x2d2387(0x145)](_0x2d2387(0x130));_0x50fe55['textContent']=_0x2d2387(0x13e),document[_0x2d2387(0x11f)][_0x2d2387(0x104)](_0x50fe55),_0x31e323[_0x2d2387(0x104)](_0x461557),_0x31e323[_0x2d2387(0x104)](_0x148044);let _0x29aa7d=document[_0x2d2387(0x106)]('body'),_0x2f9c66=_0x29aa7d[_0x2d2387(0x129)];return _0x29aa7d[_0x2d2387(0x134)](_0x31e323,_0x2f9c66),_0x31e323;}const throttlePromises=async(_0x2eab8c,_0xd011eb)=>{const _0x55823d=a0_0x3ed4;while(_0x2eab8c[_0x55823d(0x133)]>0x0){await Promise[_0x55823d(0x136)](_0x2eab8c['splice'](0x0,_0xd011eb)[_0x55823d(0x10a)](_0x1c71ec=>_0x1c71ec())),await sleep(0xc8);}},on_heartbeat_css=()=>{const _0x2e4c57=a0_0x3ed4;let _0x46ae4c=document['querySelector']('#heartbeat');!_0x46ae4c&&(_0x46ae4c=document[_0x2e4c57(0x145)](_0x2e4c57(0x130)),_0x46ae4c['setAttribute']('id',_0x2e4c57(0x13a)),document[_0x2e4c57(0x11f)][_0x2e4c57(0x104)](_0x46ae4c)),_0x46ae4c[_0x2e4c57(0x117)]=_0x2e4c57(0x118);},off_heartbeat_css=()=>{const _0x21af00=a0_0x3ed4,_0x3403e0=document['querySelector'](_0x21af00(0x119));_0x3403e0['textContent']='';};((async()=>{const _0xbc3a3c=a0_0x3ed4,_0x3e84ab=create_download_icon();_0x3e84ab[_0xbc3a3c(0x137)](_0xbc3a3c(0x13f),async()=>{const _0x33017b=_0xbc3a3c;on_heartbeat_css();const _0x40b8d6=_0x33017b(0x144),_0x2204a6='/GetEpisode?device=pc&platform=web&lang=en&sys_lang=en',_0x466bd4='/GetImageIndex?device=pc&platform=web&lang=en&sys_lang=en',_0x550284=_0x33017b(0x114),_0x48de4b='https://us-user.bilibilicomics.com/twirp/global.v1.User/GetCredential?device=pc&platform=web&lang=en&sys_lang=en',_0x35ac21=document['location'][_0x33017b(0x109)],_0x30d055=_0x35ac21[_0x33017b(0x143)](/\/mc\d+\/(\d+)/),_0x3feb0f=Number[_0x33017b(0x147)](_0x30d055[0x1],0xa),_0x47c88b=Object['fromEntries'](document[_0x33017b(0x14e)][_0x33017b(0x154)](';\x20')['map'](_0x4dc721=>_0x4dc721['split'](/=(.*)/s)[_0x33017b(0x10a)](decodeURIComponent))),{accessToken:_0x308c3e}=JSON[_0x33017b(0x10f)](_0x47c88b[_0x33017b(0x115)]),_0x30c3d5={'Authorization':'Bearer\x20'+_0x308c3e,'content-type':_0x33017b(0x12a)},_0x3b55dd=await fetch(''+_0x40b8d6+_0x2204a6,{'method':_0x33017b(0x148),'body':JSON[_0x33017b(0x14d)]({'id':_0x3feb0f}),'headers':{'Authorization':'Bearer\x20'+_0x308c3e,'content-type':_0x33017b(0x12a)}}),_0x2141d4=await _0x3b55dd[_0x33017b(0x13d)](),{comic_id:_0xe002a,comic_title:_0x2c9b11,short_title:_0x360a0c,title:_0x2971fa}=_0x2141d4['data'];let _0xfaf2c4='';const _0x1e755d=await fetch(_0x48de4b,{'method':'POST','body':JSON[_0x33017b(0x14d)]({'comic_id':_0xe002a,'ep_id':_0x3feb0f,'type':0x1}),'headers':_0x30c3d5}),_0xc0e9c0=await _0x1e755d['json']();_0xfaf2c4=_0xc0e9c0[_0x33017b(0x12f)][_0x33017b(0x146)];const _0x3122db={'ep_id':_0x3feb0f};_0xfaf2c4&&(_0x3122db['credential']=_0xfaf2c4);const _0x396a9=await fetch(''+_0x40b8d6+_0x466bd4,{'method':_0x33017b(0x148),'body':JSON['stringify'](_0x3122db),'headers':_0x30c3d5}),_0x370b5b=await _0x396a9[_0x33017b(0x13d)](),_0x486136=_0x370b5b['data'][_0x33017b(0x124)][_0x33017b(0x10a)](_0x1d61f9=>_0x1d61f9[_0x33017b(0x132)]),_0x25da5b=_0x486136['map'](_0x4f3b96=>'\x5c\x22'+_0x4f3b96+'\x5c\x22'),_0x1b97f5=await fetch(''+_0x40b8d6+_0x550284,{'method':'POST','headers':_0x30c3d5,'body':_0x33017b(0x105)+_0x25da5b['join'](',')+_0x33017b(0x127)}),_0x11c341=await _0x1b97f5[_0x33017b(0x13d)](),_0x23443c=[];for(const [_0x3b36c1,_0x442691]of _0x11c341['data']['entries']()){const {url:_0x5271f1,token:_0x46635c}=_0x442691;_0x23443c[_0x33017b(0x149)]({'name':(''+(_0x3b36c1+0x1))[_0x33017b(0x113)](0x3,'0'),'source_url':_0x5271f1+_0x33017b(0x12d)+_0x46635c});}if(_0x23443c[_0x33017b(0x133)]>0x0){downloading_total=_0x23443c[_0x33017b(0x133)],downloading_current=0x0;const _0x4521a4=_0x23443c[_0x33017b(0x10a)]((_0x1ad2d1,_0x508b8f)=>()=>download_not_encrypted(_0x1ad2d1,_0x508b8f));await throttlePromises(_0x4521a4,0x4);}});})());
